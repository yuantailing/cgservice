<VirtualHost *:80>
	ServerName cg.cs.tsinghua.edu.cn
	ServerAlias www.thucg.com
	ServerAlias 166.111.68.30

	DocumentRoot /srv/ftp/cscg
	Proxypass /php http://php/cscg/php
	Proxypass /backend/phpmyadmin/ http://phpmyadmin/
	Proxypass /serverlist http://cgserver/serverlist
	Proxypass /download9 http://download/download9
	Proxypass /csvn http://csvn:3343/csvn
	Proxypass /viewvc https://csvn/viewvc
	Proxypass /viewvc-static https://csvn/viewvc-static
	Proxypass /svn https://csvn/svn
	ProxyPassMatch "^/(latex/socket\.io/\d+/websocket/.+)$" "ws://sharelatex/$1"
	Proxypass /latex http://sharelatex/latex
	ProxyPassReverse /backend/phpmyadmin/ /phpmyadmin/
	ProxypassReverse /csvn http://csvn:3343/csvn
	ProxypassReverse https://%{SERVER_NAME}/csvn https://csvn:4434/csvn
	ProxypassReverse /svn https://csvn/svn
	ProxyPassReverseCookiePath /phpmyadmin/ /backend/phpmyadmin/
	ProxyPreserveHost On
	<Directory /srv/ftp/cscg/>
		Require all granted
	</Directory>

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	RewriteEngine on
	RewriteCond %{SERVER_NAME} !=cg.cs.tsinghua.edu.cn
	RewriteCond %{SERVER_NAME} !=166.111.68.30
	RewriteCond %{REQUEST_URI} !^/download9(/.*)?$
	RewriteCond %{REQUEST_URI} !^/latex(/.*)?$
	RewriteRule ^(.*)$ $1 [END,NE,R=404]
	#RewriteCond %{SERVER_NAME} =cg.cs.tsinghua.edu.cn
	#RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R]
	#RewriteCond %{SERVER_NAME} =166.111.68.30
	#RewriteRule ^ https://cg.cs.tsinghua.edu.cn%{REQUEST_URI} [END,NE,R]
</VirtualHost>
