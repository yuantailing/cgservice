<IfModule mod_ssl.c>
<VirtualHost *:443>
	ServerName cg.cs.tsinghua.edu.cn
	ServerAlias 166.111.68.30

	DocumentRoot /srv/ftp/cscg
	Proxypass /php http://php/cscg/php
	Proxypass /backend/phpmyadmin/ http://phpmyadmin/
	Proxypass /serverlist http://cgserver/serverlist
	Proxypass /download9 http://download/download9
	Proxypass /csvn https://csvn:4434/csvn
	Proxypass /viewvc https://csvn/viewvc
	Proxypass /viewvc-static https://csvn/viewvc-static
	Proxypass /svn https://csvn/svn
	ProxyPassMatch "^/(latex/socket\.io/\d+/websocket/.+)$" "ws://sharelatex/$1"
	Proxypass /latex http://sharelatex/latex
	ProxyPassReverse /backend/phpmyadmin/ /phpmyadmin/
	ProxypassReverse /csvn https://csvn:4434/csvn
	ProxypassReverse /svn https://csvn/svn
	ProxyPassReverseCookiePath /phpmyadmin/ /backend/phpmyadmin/
	ProxyPreserveHost On
	<Directory /srv/ftp/cscg/>
		Require all granted
	</Directory>

	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined

	RewriteEngine on
	RewriteCond %{SERVER_NAME} =166.111.68.30
	RewriteRule ^ https://cg.cs.tsinghua.edu.cn%{REQUEST_URI} [END,NE,R]

	#SSLProxyEngine on
	#SSLProxyCheckPeerName off
	#SSLCertificateFile /etc/letsencrypt/live/cgservice/fullchain.pem
	#SSLCertificateKeyFile /etc/letsencrypt/live/cgservice/privkey.pem
	#Include /opt/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>
